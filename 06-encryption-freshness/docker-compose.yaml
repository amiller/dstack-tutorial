services:
  app:
    build:
      context: .
      dockerfile_inline: |
        FROM python:3.11-slim
        WORKDIR /app
        RUN pip install flask psycopg2-binary pynacl dstack-sdk
        COPY app.py .
        CMD ["python", "app.py"]
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=${DATABASE_URL}
    volumes:
      - /var/run/dstack.sock:/var/run/dstack.sock
